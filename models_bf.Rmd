---
title: "models_bf"
author: "David Gibert Bosque"
date: "December 14, 2018"
output: html_document
---
```{r include=FALSE}
rm(list = ls())
```

```{r include=FALSE}
### LIBRARIES ###
library(dplyr)
library(Metrics)
library(rpart)
library(doParallel)
library(rpart.plot)
library(fastDummies)
library(ggplot2)
library(elasticnet)
library(lars)
library(caret)
library(AppliedPredictiveModeling)
library(e1071)
library(pls)
library(plotly)
```

```{r include=FALSE}
## LOADING DATA
setwd("C:/Users/David/Google Drive/Github/task3-2-wifi-dgibert17")

load(file = "training.Rdata")
load(file = "validation.Rdata")

# cl <- makeCluster(3)
# doParallel:::registerDoParallel(cl)
```

#### PREDICCIONES SOBRE BF
## Predicting BF - KNN
```{r warning=FALSE}
bf.vec = createDataPartition(y = df.train$BF, p = 0.15)

# Training data
# bf.tr = df.train[bf.vec$Resample1, c(1:last(grep(pattern = "WAP", names(df.train))), which(names(df.train) == "BF"))]
bf.tr = df.train[bf.vec$Resample1, c(1:last(grep(pattern = "WAP", names(df.train))), 316,322)]
bf.tr$BUILDINGID = factor(bf.tr$BUILDINGID)
df.val$BUILDINGID = factor(df.val$BUILDINGID)

# Test data
# VALIDATION DF

# Tabla de proporciones para ver que la proporcion de observaciones por BUILDING es la misma en el DF original que en el bf.tr
prop.table(table(df.train$BF))
prop.table(table(bf.tr$BF))

ctrl = trainControl(method = "repeatedcv",
                    number = 3,
                    repeats = 10)

knn.fit.bf = train(BF~.,
                method = "knn",
                trControl = ctrl,
                data = bf.tr)
knn.fit.bf

knn.pred.bf = predict(knn.fit.bf, df.val)
accuracy(actual = df.val$BF, predicted = knn.pred.bf)

#Cuantas observaciones hay predichas por edificio y cuantas hay en realidad en total.
table(knn.pred.bf)
table(df.val$BF)

#Cuantos dispositivos se han clasificado mal por cada edificio.
abs(table(knn.pred.bf) - table(df.val$BF))
```

## Predicting BF - SVM
```{r warning=FALSE}
svmLin.fit.bf <- train(BF~.,
                    method = "svmLinear",
                    trControl = ctrl,
                    data = bf.tr
                   )
svmLin.fit.bf

svmLin.pred.bf = predict(svmLin.fit.bf, df.val)
accuracy(actual = df.val$BF, predicted = svmLin.pred.bf)


svmRad.fit.bf <- train(BF~.,
                    method = "svmRadial",
                    trControl = ctrl,
                    data = bf.tr
                   )
svmRad.fit.bf

svmRad.pred.bf = predict(svmRad.fit.bf, df.val)
accuracy(actual = df.val$BF, predicted = svmRad.pred.bf)
```

## Predicting BF - RF
```{r}
rf.fit.bf = train(BF~.,
                  data = bf.tr,
                  method = "rf",
                  ntree = 40,
                  trControl = ctrl,
                  allowParallel = TRUE
                  )
rf.fit.bf

rf.pred.bf = predict(rf.fit.bf, df.val)
accuracy(actual = df.val$BF, predicted = rf.pred.bf)
```
